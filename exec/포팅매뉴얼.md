## 1. ê°œìš”

**Cell Check** í”„ë¡œì íŠ¸ëŠ” **Spring Boot, Python, React**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.

**Docker**ì™€ **PostgreSQL(TimeScaleDB)**ë¥¼ ****ì‚¬ìš©í•˜ì˜€ìœ¼ë©°, **FastAPI ì„œë²„**, **PostgreSQL**, **ìŠ¤í”„ë§ ì„œë²„**, **React**ë¥¼ ê°ê° ì»¨í…Œì´ë„ˆì— ë‹´ì•„ ë°°í¬í•˜ì˜€ìŠµë‹ˆë‹¤. ë³¸ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ë¥¼ ë°°í¬í•˜ê³  ìš´ì˜í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

### 1.1. í”„ë¡œì íŠ¸ ì‚¬ìš© ë„êµ¬

```markdown
ì´ìŠˆ ê´€ë¦¬ : JIRA
í˜•ìƒ ê´€ë¦¬ : Gitlab
ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ : Notion, Meattermost
ë””ìì¸ : React
CI/CD : PostgreSQL
```

### 1.2. ê°œë°œ í™˜ê²½

```markdown
# Fronend
React : RechartJs, TalewindJs
Visual Studio Code : 1.100.2

# Backend
Java 17
SpringBoot 3.4.5
JPA
PostgreSQL

# infra
Docker
DockerCompose
Jenkins
Nginx
Mosquitto

# AI
PyTorch
Tensorflow
OpenCV
FastAPI
Pandas
Numpy

```

[í¬íŒ…ë©”ë‰´ì–¼.pdf](attachment:bca6aa21-f99c-4c2b-9ee5-b0c4629f8775:í¬íŒ…ë©”ë‰´ì–¼.pdf)

## 2. í™˜ê²½ ì„¤ì •

### 2.1 EC2ì— í•„ìš”í•œ í”„ë¡œê·¸ë¨ ì„¤ì¹˜

EC2 ì„œë²„ì—ì„œ ë°°í¬ì— í•„ìš”í•œ í”„ë¡œê·¸ë¨ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
# ğŸ”„ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ìµœì‹ í™”
sudo apt update

# â˜• Java ì„¤ì¹˜ (Spring Boot êµ¬ë™ìš©)
sudo apt install openjdk-21-jdk -y  # Java 21 ì„¤ì¹˜

# ğŸ³ Docker ì„¤ì¹˜
sudo apt install docker.io -y       # Docker ì„¤ì¹˜
sudo systemctl start docker         # Docker ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl enable docker        # ë¶€íŒ… ì‹œ Docker ìë™ ì‹œì‘

# ğŸ³ Docker Compose ì„¤ì¹˜
sudo curl -L "https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose  # ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬

# ğŸ”§ Git ì„¤ì¹˜ (Amazon Linux ê¸°ì¤€ yum, UbuntuëŠ” apt ì‚¬ìš©)
sudo apt install git -y             # Git ì„¤ì¹˜

# ğŸŒ Nginx ì„¤ì¹˜
sudo apt install nginx -y           # ì›¹ ì„œë²„ ì„¤ì¹˜

```

### 2-2 EC2 ë°©í™”ë²½ ì„¤ì •

UFWë¥¼ ì´ìš©í•´ ë°°í¬ì— í•„ìš”í•œ í¬íŠ¸ë¥¼ ì˜¤í”ˆí•©ë‹ˆë‹¤.

```bash
# ğŸ”“ í¬íŠ¸ í—ˆìš©
sudo ufw allow 80        # HTTP
sudo ufw allow 443       # HTTPS
sudo ufw allow 8080      # Spring Boot (ì›¹ í¬íŠ¸)
sudo ufw allow 18080     # Jenkins

# âœ… ë°©í™”ë²½ í™œì„±í™” ë° ìƒíƒœ í™•ì¸
sudo ufw enable
sudo ufw status

```

## 3. ë°°í¬ íŒŒì¼

### 3.1. DockerFile(Python)

```bash
# âœ… Python 3.9.13 slim ì´ë¯¸ì§€ ì‚¬ìš©
FROM python:3.9.13-slim

# í•„ìˆ˜ ì‹œìŠ¤í…œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (libGL í¬í•¨)
RUN apt-get update && apt-get install -y \
    libgl1 \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# âœ… ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±
WORKDIR /app

# âœ… ì˜ì¡´ì„± íŒŒì¼ ë¨¼ì € ë³µì‚¬
COPY requirements.txt .

# âœ… pip ì—…ê·¸ë ˆì´ë“œ ë° ì˜ì¡´ì„± ì„¤ì¹˜
RUN pip install --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

# âœ… ì „ì²´ ì½”ë“œ ë³µì‚¬
COPY . .

# âœ… ì™¸ë¶€ í¬íŠ¸ ì˜¤í”ˆ (WebSocketìš© 8000)
EXPOSE 8000

# âœ… WebSocket ì„œë²„ ì‹¤í–‰
CMD ["python", "run_server.py"]
```

### 3.2. Docker-Compose íŒŒì¼

```bash
version: '3.8'

services:
  # PostgreSQL + TimescaleDB: ì‹œê³„ì—´ DB ê¸°ëŠ¥ì´ ì¶”ê°€ëœ PostgreSQL
  timescaledb:
    image: timescale/timescaledb:2.17.1-pg14
    container_name: timescaledb
    restart: always
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - "5432:5432" #í˜¸ìŠ¤íŠ¸ <-> ì»¨í…Œì´ë„ˆ í¬íŠ¸ ë°”ì¸ë”©
    volumes:
      - timescaledb_data:/var/lib/postgresql/data # DB ì§€ì†ì ìœ¼ë¡œ ë³¼ë¥¨ ë§ˆìš´íŠ¸
    networks:
      - app-network # ì»¨í…Œì´ë„ˆë¼ë¦¬ì˜ ê³µí†µ ë„¤íŠ¸ì›Œí¬ ì„¤ì •

  # Nginx
  nginx:
    image: nginx:1.26.3
    container_name: nginx
    restart: always
    ports:
      - "80:80" #HTTP
      - "443:443" #for HTTPS
    volumes:
      - ./nginx/html:/usr/share/nginx/html # ì •ì íŒŒì¼ê²½ë¡œ
      - ./nginx/conf:/etc/nginx/conf.d # Nginx ì„¤ì • íŒŒì¼
      - ./nginx/ssl:/etc/nginx/ssl 
    # depends_on:
    #   - springboot # ì‹¤í–‰ìˆœì„œë³´ì¥ (nginx ì‹¤í–‰ ì „ ì‹¤í–‰)
    #   # - fastapi
    networks:
      - app-network
    
  # BE
  springboot:
    image: eclipse-temurin:17-jdk
    container_name: springboot-app
    restart: always
    ports:
      - "8080:8080"
    working_dir: /app #ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
    volumes: 
      - ./springboot/app/app.jar:/app/app.jar
      - ./mosquitto/certs/ca.crt:/app/ca.crt # mqtt í†µì‹ ì„ ìœ„í•´ ca.crt ì¶”ê°€.
    command: ["java", "-jar", "app.jar"]
    environment:
      SPRING_PROFILES_ACTIVE: prod # ê¸°ë³¸.yml ì½ê³  -prod ì½ê¸°
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL}
      SPRING_DATASOURCE_USERNAME: ${SPRING_DATASOURCE_USERNAME}
      SPRING_DATASOURCE_PASSWORD: ${SPRING_DATASOURCE_PASSWORD}
      SERVER_PORT: ${SERVER_PORT}
      DB_URL: ${DB_URL}
      DB_ID: ${DB_ID}
      DB_PASSWORD: ${DB_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      HTTP_URL: ${HTTP_URL}
      HTTPS_URL: ${HTTPS_URL}
      SWAGGER_NAME: ${SWAGGER_NAME}
      SWAGGER_PWD: ${SWAGGER_PWD}
      MQTT_BROKER: ${MQTT_BROKER}
      MQTT_USERNAME: ${MQTT_USERNAME}
      MQTT_PASSWORD: ${MQTT_PASSWORD}
      MQTT_CERTPATH: ${MQTT_CERTPATH}

    depends_on:
      - timescaledb
    networks:
      - app-network
  
  # MQTT ë¸Œë¡œì»¤ (H/W í†µì‹ ìš©)
  mosquitto:
    image: eclipse-mosquitto:2.0.18
    container_name: mosquitto
    restart: always
    ports:
      - "1883:1883" # ê¸°ë³¸
      - "8883:8883" # TLS 
    volumes:
      - ./mosquitto/config:/mosquitto/config
      - ./mosquitto/data:/mosquitto/data
      - ./mosquitto/log:/mosquitto/log
      - ./mosquitto/certs:/mosquitto/certs
    networks:
      - app-network
  
  # Jenkins: CI/CD
  jenkins:
    image: jenkins/jenkins:lts-jdk17 # JDK 17 ê¸°ë°˜ LTS
    container_name: jenkins
    restart: always
    ports:
      - "8088:8080" # WebUI
      - "50000:50000" # ë¹Œë“œ ë…¸ë“œ ì—°ê²°
    volumes:
      - jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock # ì†Œì¼“ë§ˆìš´íŠ¸
      - /usr/bin/docker:/usr/bin/docker # ë°”ì´ë„ˆë¦¬ ë§ˆìš´íŠ¸
      - /usr/bin/docker-compose:/usr/local/bin/docker-compose # Docker Compose ë°”ì´ë„ˆë¦¬ ë§ˆìš´íŠ¸
      - /home/ubuntu/docker-services:/home/ubuntu/docker-services # í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ê°„ ê³µìœ  ë””ë ‰í† ë¦¬
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock # Docker í˜¸ìŠ¤íŠ¸ ì„¤ì •
      - DOCKER_GROUP_ID=${DOCKER_GROUP_ID}
      - JENKINS_OPTS="--prefix=/jenkins"
    user: root 
    group_add:
      - ${DOCKER_GROUP_ID}
    networks:
      - app-network

# ê³µí†µ ë„¤íŠ¸ì›Œí¬
networks:
  app-network:
    driver: bridge
    
# ë³¼ë¥¨ ì •ì˜
volumes:
  timescaledb_data:
  jenkins_home:
  grafana_data:
  portainer_data:
  
```

### 3.3 Jenkins íŒŒì¼

- SpringBoot
    
    ```bash
    	pipeline {
        agent any
    
        environment {
            // ë„ì»¤ ê´€ë ¨ ì„¤ì •
            DOCKER_IMAGE = credentials('SPRING_IMAGE')
            DOCKER_CONTAINER = credentials('SPRING_CONTAINER')
            DOCKER_PORT = credentials('SPRING_PORT')
            DOCKER_PATH = credentials('DOCKER_PATH')
    
            // EC2 ê´€ë ¨ ì„¤ì •
            EC2_USER = credentials('EC2_USER')
            EC2_IP = credentials('EC2_IP')
            SSH_KEY = credentials('SSH_KEY')
    
            // ë°ì´í„°ë² ì´ìŠ¤ ìê²© ì¦ëª…
            DB_URL = credentials('DB_URL')
            DB_USERNAME = credentials('DB_USERNAME')
            DB_PASSWORD = credentials('DB_PASSWORD')
    
            // Java ë° Gradle ê²½ë¡œ ì„¤ì •
            JAVA_HOME = '/opt/java/openjdk'
            GRADLE_HOME = '/opt/gradle/gradle-8.13'
            PATH = "${JAVA_HOME}/bin:${GRADLE_HOME}/bin:${env.PATH}"
        }
    
        tools {
            jdk 'JDK17'
            gradle 'Gradle 8.13'
        }
    
        stages {
            stage('Clone Repository') {
                steps {
                    echo 'ì €ì¥ì†Œ ë³µì œ ì¤‘...'
                    checkout scm
                }
            }
    
            stage('Build Application') {
                steps {
                    echo 'Gradleë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ ì¤‘...'
                    dir('back/cellcheck') {
                        sh 'chmod +x ./gradlew'
                        sh './gradlew clean build -x test'
                        sh 'ls -la build/libs'
                    }
                }
            }
    
            stage('Deploy with Docker Compose') {
                steps {
                    echo 'Docker Composeë¡œ ë°°í¬ ì¤‘...'
    
                    //docker_path ê²½ë¡œí™•ì¸
                    sh 'echo "DOCKER_PATH = ${DOCKER_PATH}"'
                    //sh 'find / -name app.jar -type f 2>/dev/null'
    
                    // JAR íŒŒì¼ì„ Docker Compose ë³¼ë¥¨ ê²½ë¡œë¡œ ë³µì‚¬
                    sh 'mkdir -p /home/ubuntu/docker-services/springboot/app'
                    sh 'cp back/cellcheck/build/libs/cellcheck-0.0.1-SNAPSHOT.jar /home/ubuntu/docker-services/springboot/app/app.jar'
    
                    // íŒŒì¼ ê¶Œí•œ ì„¤ì •
                    sh 'chmod 644 /home/ubuntu/docker-services/springboot/app/app.jar'
    
                    sh '''
                        cd /home/ubuntu/docker-services
                        /usr/bin/docker stop springboot-app || true
                        /usr/bin/docker rm springboot-app || true
                        /usr/local/bin/docker-compose up -d springboot
                    '''
    
                }
            }
        }
    
        post {
            success {
                echo 'ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!'
            }
            failure {
                echo 'ë°°í¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
            }
        }
    }
    
    ```
    
- React
    
    ```bash
    pipeline {
        agent any
        tools {
            nodejs 'node18'
        }
        environment {
            GIT_CREDENTIALS_ID = 'GitLab-PAT'
            FRONT_PROJECT_DIR = "cellcheck-fe"
            DIST_DIR = "cellcheck-fe/dist"
            NGINX_HTML_DIR = "/home/ubuntu/docker-services/nginx/html"
        }
        stages {
            stage('Checkout Code') {
                steps {
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: 'develop-fe']],
                        userRemoteConfigs: [[
                            url: 'https://lab.ssafy.com/s12-final/S12P31D106',
                            credentialsId: "${GIT_CREDENTIALS_ID}" // 'GitLab-PAT' ID ì‚¬ìš©
                        ]]
                    ])
                    sh 'echo "âœ… ì½”ë“œ ì²´í¬ì•„ì›ƒ ì™„ë£Œ"'
                }
            }
    
            
            stage('Build Frontend') {
                steps {
                    dir("${FRONT_PROJECT_DIR}") {
                        sh '''
                        echo "âœ… í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì‹œì‘"
                        rm -rf node_modules dist
                        npm install --legacy-peer-deps
                        npm run build
                        echo "âœ… í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì™„ë£Œ"
                        '''
                    }
                }
            }
            
            stage('Deploy to Nginx') {
                steps {
                    sh """
                    echo "[INFO] Nginx ë””ë ‰í† ë¦¬ ìƒì„±..."
                    mkdir -p ${NGINX_HTML_DIR}
                    
                    echo "[INFO] ê¸°ì¡´ íŒŒì¼ ì‚­ì œ ì¤‘..."
                    rm -rf ${NGINX_HTML_DIR}/*
                    
                    echo "[INFO] ìƒˆë¡œìš´ ë¹Œë“œ íŒŒì¼ ë³µì‚¬ ì¤‘..."
                    cp -r ${DIST_DIR}/* ${NGINX_HTML_DIR}/
                    
                    echo "[INFO] ê¶Œí•œ ì„¤ì •..."
                    chmod -R 755 ${NGINX_HTML_DIR}
                    
                    echo "[INFO] Nginx ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì¤‘..."
                    cd /home/ubuntu/docker-services
                    docker restart nginx
                    echo "[INFO] ë°°í¬ ì™„ë£Œ âœ…"
                    """
                }
            }
        }
        
        post {
            success {
                echo "ğŸ‰ ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            }
            failure {
                echo "âŒ ë°°í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
            }
        }
    }
    ```
    

### 3.4 Nginx.conf íŒŒì¼

```bash
server {
    listen 80 default_server;
    server_name _;
    
    # Let's Encrypt ì¸ì¦ì„œ ê°±ì‹ ì„ ìœ„í•œ ê²½ë¡œ
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/html;
    }
    
    # HTTPë¥¼ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name _;
    
    # SSL ì„¤ì •
    ssl_certificate /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    
    # í”„ë¡ì‹œ í—¤ë” ì„¤ì •
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # ê¸°ë³¸ CORS ì„¤ì •
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
    add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
    
    # React ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ì •ì  íŒŒì¼ ì„œë¹™
    location / {
        # í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ ì²˜ë¦¬
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain; charset=utf-8';
            add_header 'Content-Length' 0;
            return 204;
        }
        
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }
    # Jenkins ì„œë¹„ìŠ¤ í”„ë¡ì‹œ
    location /jenkins/ {
        # í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ ì²˜ë¦¬
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain; charset=utf-8';
            add_header 'Content-Length' 0;
            return 204;
        }
        
        proxy_pass http://jenkins:8080;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Prefix /jenkins; 
        proxy_redirect default; #ë¦¬ë‹¤ì´ë ‰íŠ¸íŠ¸

        # ì›¹ì†Œì¼“
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;

        # ì¿ í‚¤ ê²½ë¡œ
        proxy_cookie_path /jenkins /jenkins;
    }
    
    # Spring Boot API ìš”ì²­ í”„ë¡ì‹œ
    location /api {
        # í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ ì²˜ë¦¬
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain; charset=utf-8';
            add_header 'Content-Length' 0;
            return 204;
        }
        
        proxy_pass http://springboot:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;  # WebSocket ì—°ê²° íƒ€ì„ì•„ì›ƒ ì„¤ì • (24ì‹œê°„)
    }

    # Swagger UI ê²½ë¡œ ì„¤ì •
    location ~ ^/(swagger-ui|v3/api-docs) {
        # í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ ì²˜ë¦¬
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain; charset=utf-8';
            add_header 'Content-Length' 0;
            return 204;
        }
        
        proxy_pass http://springboot:8080;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /ai {
        proxy_pass http://18.179.245.89:8000;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;

        proxy_read_timeout 86400;

        # CORS ëŒ€ì‘
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';

        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }
    # # FastAPI ì„œë¹„ìŠ¤ í”„ë¡ì‹œ
    # location /fastapi {
    #     # í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ ì²˜ë¦¬
    #     if ($request_method = 'OPTIONS') {
    #         add_header 'Access-Control-Allow-Origin' '*';
    #         add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
    #         add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
    #         add_header 'Access-Control-Max-Age' 1728000;
    #         add_header 'Content-Type' 'text/plain; charset=utf-8';
    #         add_header 'Content-Length' 0;
    #         return 204;
    #     }
        
    #     proxy_pass http://fastapi:8000;
    #     proxy_http_version 1.1;
    #     proxy_set_header Upgrade $http_upgrade;
    #     proxy_set_header Connection "upgrade";
    #     proxy_read_timeout 86400;  # WebSocket ì—°ê²° íƒ€ì„ì•„ì›ƒ ì„¤ì • (24ì‹œê°„)
    # }
}

```

### 3.6. Mosquitto.conf íŒŒì¼

```bash
persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log
log_type all

listener 1883
protocol mqtt
allow_anonymous false

listener 8883
protocol mqtt
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
require_certificate false
allow_anonymous false
password_file /mosquitto/config/password
```

### 3.5. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •(.env íŒŒì¼)

```bash
# JWT ì„¤ì •
JWT_SECRET=s8dF4jKl2mP9qR7tZ5xV3wY1bN6cA0uewqw

#Server
SERVER_PORT=8080

#DB
DB_URL_LOCAL=jdbc:postgresql://k12d106.p.ssafy.io:5432/cellcheck?ssl=false&TimeZone=Asia/Seoul
DB_URL=jdbc:postgresql://timescaledb:5432/cellcheck?ssl=false&TimeZone=Asia/Seoul
DB_ID=k106
DB_PASSWORD=cellcheck123!

# ì•„ë˜ëŠ” EC2 .env
POSTGRES_PASSWORD=cellcheck123!
POSTGRES_USER=k106
POSTGRES_DB=cellcheck

DOCKER_GROUP_ID=122

# springboot ì„¤ì •ë“¤
SPRING_DATASOURCE_URL=jdbc:postgresql://timescaledb:5432/cellcheck?ssl=false&TimeZone=Asia/Seoul
SPRING_DATASOURCE_USERNAME=k106
SPRING_DATASOURCE_PASSWORD=cellcheck123!

HTTP_URL=http://k12d106.p.ssafy.io
HTTPS_URL=https://k12d106.p.ssafy.io

SWAGGER_NAME=redlaw553
SWAGGER_PWD=cellcheck553!

MQTT_BROKER=ssl://k12d106.p.ssafy.io:8883
MQTT_USERNAME=cellcheck
MQTT_PASSWORD=ssafy123!
MQTT_CERTPATH=/app/ca.crt
```

**ë³´ì•ˆ ì£¼ì˜ì‚¬í•­**

- .gitignoreì— í™˜ê²½ë³€ìˆ˜ ë° ë¯¼ê°ì •ë³´ëŠ” ë“±ë¡í•´ë‘¬ì•¼í•¨
- íš¨ê³¼ì ì¸ ê°œë°œ íë¦„ì„ ìœ„í•´ application-local.yaml íŒŒì¼ì„ .gitignoreë¡œ ë“±ë¡í•´ë‘ê³  ì§ì ‘ ê²½ë¡œ ì„¤ì •, ì´ì™¸ í™˜ê²½ë³€ìˆ˜ëŠ” EC2ì— ì§ì ‘ í™˜ê²½ë³€ìˆ˜ íŒŒì¼ì— ì¶”ê°€

## 4. ì„œë²„ ë°°í¬ (EC2)

- ì²˜ìŒë¶€í„° ë¡œì»¬ì—ì„œ ì‘ì—…í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ VSCODEì˜ `Remote-SSH`ë¥¼ ì´ìš©í•´ ì„œë²„ ë‚´ì—ì„œ ì§ì ‘ íŒŒì¼ ì‘ì—…
- /home/ubuntu/docker-services ë””ë ‰í† ë¦¬ ìƒì„±í›„ ì´ê³³ì— ê¸°ë³¸ì ì¸ íŒŒì¼ë“¤ ì‘ì—…

  ![alt text](image.png)

- AI ëª¨ë¸ì´ GPUê°€ í•„ìš”í•¨ì— ë”°ë¼ ìƒˆë¡œì´ G6-xlarge ë° í”„ë¦¬í‹°ì–´ ubuntu ëª¨ë¸ì„ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    - í•´ë‹¹ EC2ì„œë²„ í¬íŠ¸ëŠ” 8000í¬íŠ¸ì— ê¸°ë³¸ ì œê³µ EC2 ì„œë²„ public IPë¥¼ ë“±ë¡í•˜ì—¬ Nginx proxy passë¥¼ í†µí•´ ì§„ì…í•˜ì—¬ ë¬¶ìŒ

## 5. ë°°í¬ íë¦„

- docker-compose up ëª…ë ¹ì–´ ì‹¤í–‰ì„ í†µí•´ í•„ìš”í•œ ì»¨í…Œì´ë„ˆë“¤ (**Springboot, TimeScaleDB, Jenkins,Nginx, Mosquitto)** ì„ ì‹¤í–‰
- ê°œë°œìê°€ develop-back í˜¹ì€ develop-feë¸Œëœì¹˜ì— ì½”ë“œë¥¼ í‘¸ì‹œ
- GitLAb Webhookì˜ í‘¸ì‹œ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ê°ê° Jenkinsì— ì „ë‹¬
- JenkinsëŠ” í•´ë‹¹ ì´ë²¤íŠ¸ì—ë”°ë¼ íŠ¸ë¦¬ê±°ê°€ ë°œìƒí•œ ë¸Œëœì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **Springboot** í˜¹ì€ **React**ë¥¼ ë¹Œë“œ
- ë¹Œë“œëœ **.jar** í˜¹ì€ **node.js**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ìƒì„±