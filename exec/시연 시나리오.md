# 시연 시나리오

---

1. **컨베이어 벨트 동작 버튼을 누른다.**
    
    → 컨베이어 벨트가 동작한다.
    
2. **검사할 배터리를 컨베이어 벨트에 올린다.**
    
    → 배터리가 컨베이어 벨트를 따라 이동하며 적외선 센서에 감지된다.
    
    → 첫 번째 차단판에서 배터리가 정렬된다.
    
3. **차단판에 배터리가 감지된 지 5초 후, 차단판이 열린다.**
    
    → 2초 후 차단판이 다시 내려간다.
    
    → 차단판이 내려간 이후부터 다음 배터리 진입이 가능하다.
    
4. **배터리가 이동하여 두 번째 적외선 센서에 감지된다.**
    
    → 두 번째 차단판에서 배터리가 멈추며 회전하기 시작한다.
    
    → 젯슨 나노가 카메라로 회전 중인 배터리의 사진을 촬영한다.
    
5. **촬영된 사진이 AI 서버로 전송되어 외부 상태 및 배터리 타입을 판단한다.**
    
    → 판단이 완료되면 컨베이어 벨트가 정지한다.
    
6. **외부 상태 결과와 배터리 타입 정보를 젯슨 나노가 수신한다.**
7. **컨베이어 벨트가 정지한다**
8. **외부 상태 결과에 따라 다음 동작이 실행된다.**
    - **외부 상태가 '불량'인 경우:**
        
        → 아두이노가 리니어 액추에이터를 제어하여 배터리를 불량 배터리 분리통으로 밀어낸다.
        
        → 분리 작업이 완료되면 컨베이어 벨트가 다시 작동한다.
        
    - **외부 상태가 '정상'인 경우:**
        
        → 아두이노가 배터리 타입에 따라 로봇팔을 제어하여 방전 회로에 배터리를 연결한다.
        
        **방전 기능 흐름:**
        
        1. 로봇팔 끝에 장착된 핀을 통해 방전 회로에 배터리가 연결된다.
        2. 방전 회로를 통해 방전되는 동안, INA219 센서를 통해 전압 및 전류를 측정한다.
        3. 센서에서 측정된 값은 I2C 통신으로 모니터링 아두이노에 전송된다.
        4. 아두이노는 해당 값을 통해 로드 전압을 계산한다.
        5. 버스 전압, 로드 전압, 전류 값을 시리얼 통신으로 젯슨 나노에 전송한다.
        6. 젯슨 나노는 SoC(배터리 충전 상태)를 계산하고, 아두이노로부터 받은 값과 함께 MQTT 통신으로 서버에 전송한다.
        7. 젯슨 나노가 방전 완료를 판단하면, 시리얼 통신을 통해 아두이노에 방전 완료 메시지를 전달한다.
        8. 아두이노가 로봇팔을 제어하여 배터리를 방전 회로에서 분리한다.
        
        **과열 방지 기능 흐름:**
        
        1. 방전은 회로에 연결된 저항을 통해 진행된다.
        2. 온도 센서를 통해 저항의 온도를 측정한다.
        3. 일정 온도 이상이 되면 릴레이를 제어해 쿨링팬을 작동시킨다.
        4. 온도가 위험 수준 이상이면 기존 회로를 분리하고 다른 채널의 방전 회로로 전환한다.
        5. 과열 회로의 온도가 안정되면 다시 연결 가능한 상태로 초기화된다.
9. **방전 작업이 완료되면 컨베이어 벨트가 다시 작동한다.**
10. **2초 후 차단판이 다시 올라간다.**
11. **배터리가 컨베이어 끝으로 이동하여, 방전 완료 배터리 분류통으로 떨어진다.**
